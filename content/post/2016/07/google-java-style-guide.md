+++
date = "2016-07-25T18:32:42+08:00"
description = "[译]Google Java编程风格指南"
draft = false
tags = ["Java","Style Guide","Google"]
title = "[译]Google Java编程风格指南"
topics = ["Google Java Style Guide"]

+++

## 目录

1. 介绍
2. 源文件基础
3. 源文件结构
4. 格式
5. 命名
6. 编程实战
7. Javadoc

## 介绍

这份文档是Google Java编码规范的完整定义。当且仅当一个Java源文件符合此文档中的规则， 我们才认为它符合Google的Java编程风格。<!--more-->

与其它的编程风格指南一样，这里所讨论的不仅覆盖格式化美观的问题，同时也包括其它约定和编码规范。然而，这份文档主要关注的是我们普遍遵守的规则，对于显然不是可执行的将避免给出建议。

### 术语说明

在这份文档中，除非另外声明：

1. 术语*class*表示包括一个普通类，枚举类，接口或者注解类型(@interface)。
2. 术语*comment*总是用来指代*实现(implementation)*注释。我们不使用“文档注释”一词，而是使用术语“Javadoc”。

其它的术语说明会偶尔在文档中出现。

### 指南说明

文档中的示例代码是**非规范**的。这就是说，虽然示例是Google风格的，但这不代表是代码风格的唯一方式。示例中的格式选择不应该被强制用来作为标准。

## 源文件基础

### 文件名

源文件名以其包含的顶级类(只有一个)名字来命名，且是大小写敏感的，文件扩展名为``.java``。

### 文件编码：UTF-8

源文件以UTF-8作为编码格式。

### 特殊字符

#### 空白字符

除了换行符序列，ASCII编码的水平空格字符(0x20)是唯一允许在源文件任意位置出现的空白字符。这意味着：

1. 所有其它的字符串中的空白字符和字符字面量都会被转义。
2. 制表符不用于缩进。

#### 特殊转义序列

对于任何具有特殊转义序列(``\b,\t,\n,\f,\r``,``\"``,``\'``和``\\``)的字符，使用它的特殊序列，而不是相应的八进制(比如``\012``)或者Unicode(比如``\u000a``)转义。

#### 非ASCII字符

对于剩下的非ASCII字符，是使用实际的Unicode字符还是等价的Unicode转义字符，主要取决于哪种方式更易于阅读和理解，尽管Unicode转义的字符串字面量和注释是强烈不推荐的。

> Tip:当使用一些Unicode转义字符或是实际的Unicode字符时，写一些解释注释会非常有助于阅读。

例子：

| 例子 | 讨论 |
| ------| ------ |
| ``String unitAbbrev = "μs"; `` | 最优：即使没有注释也非常清晰 |
| ``String unitAbbrev = "\u03bcs" //"μs" `` | 允许，但是没有理由这么做 |
| ``String unitAbbrev = "\u03bcs" // Greek letter mu, "s" ``|允许，但是这样做显得笨重，并且容易出错|
| ``String unitAbbrev = "\u03bcs"; ``|糟糕：阅读的人不知道这是什么|
| ``return '\ufeff' + content; // byte order mark``|好：对于非打印字符使用转义，但是必要时需要加上注释|

> Tip:永远不要由于害怕某些程序不能处理非ASCII字符而使你的代码降低可读性。如果这种情况发生了，那么那些程序是有问题的，必须被修复(fix)。

## 源文件结构

一份源文件包含(按顺序的)：

1. 许可或者版权信息，如果有的话
2. Package语句
3. Import语句
4. 有且只有一个顶级类

每个部分只用一个空白行分隔。

### 许可或者版权信息，如果存在的话

如果一个文件包含许可或者版权信息，那么它应该被放在这里。

### Package语句

package语句不换行。列限制并不适用于package语句。

### Import语句

#### 不使用通配符的Import语句

含有通配符的import语句，包括静态的和非静态的，都不要使用。

#### 不要换行

import语句是不换行的。列限制不适用于import语句。

#### 顺序和空格

import语句按以下顺序：

1. 所有的静态import语句在一个单独的块(block)中。
2. 所有的非静态import语句在一个单独的块中。

如果同时有静态的和非静态的import，用一个空行来分隔两块。除此之外，在两块之间不存在其它的空白行。

在每个块中以ASCII字符进行排序。

### 类声明

#### 只有一个顶级类声明

一个源文件只有一个顶级类声明。

#### 类成员排序

类成员的顺序对易学性有很大的影响，但这也不存在唯一正确的规则。不同的类对成员的排序可能不同。重要的是类成员的排序应该是某种逻辑排序，类维护者应该能解释它的逻辑。比如说，新的方法不应该只是习惯性地放在最后，应该放弃这种按时间的排序，因为这不是逻辑排序。

##### 重载：永远不要分离

当一个类有多个构造方法，或者多个方法有相同的名字，他们应该连续的出现，没有其它方法介于中间。

## 格式化

术语说明：*块状结构*指的是一个类的主体，方法或者构造函数。需要注意的是，任何数组的初始化结构(initializer)可以选择性的看作是一个块状结构。

### 大括号({})

#### 即使在可选的地方也应该适用大括号

大括号在``if,else,for,do``和``while``语句中使用，即使主体是空的或者只有一条语句也应该使用大括号。

#### 非空块：K&R风格

对于非空块和块状结构，大括号遵循Kernighan和Ritchie风格：

+ 在开大括号前不换行
+ 在开大括号后换行
+ 在闭大括号前换行
+ 只有当闭大括号是一个语句，方法的主体、构造函数或者命令类的终止时，则闭大括号换行。比如说，闭大括号在``else``前或者逗号前则不换行。

例子：

```java
  return () -> {
    while (condition()) {
      method();
    }
  };

  return new MyClass() {
    @Override public void method() {
      if (condition()) {
        try {
          something();
        } catch (ProblemException e) {
          recover();
        }
      } else if (otherCondition()) {
        somethingElse();
      } else {
        lastThing();
      }
    }
  };
```

在枚举类一节中，给出了一些例外。

#### 空块：也许更简洁

一个空块或者块状结构或许可以在打开后马上关闭，在开闭大括号之间没有字符或者空行。如果它是一个多块状结构语句的一部分（比如说``if/else - if/else``或者``try/catch/finally``）,那么即使大括号中间没有内容也应该换行。

例子：

```java
  void doNothing() {}
```

### 块缩进：两个空格

每次开始一个新的块，缩进增加两个空格。当块结束时，缩进使用之前的缩进级别。缩进级别对代码和注释都适用。

### 一行一条语句

每个语句后要换行。

### 列限制：100

Java代码有一个100个字符的列限制。除了下面提到的，任何行只要超过了这个限制就必须换行。

例外：

1. 不可能满足列限制的行(比如说，JavaDoc中的一个长URL，或者一个长的JSNI方法参考)。
2. ``package``或者``import``语句。
3. 注释中的可能被复制到shell中的命令行。

### 自动换行

**术语说明**：当代码由于某些原因(比如列限制)而被分为多行，这种行为称作自动换行。

没有一种广泛并且准确的准则来说明在每个情况下如何进行自动换行。通常有几种有效的方法来自动换行同一段代码。

> Tip：提取一个方法或者本地变量也许可以在不换行的情况下解决代码过长的问题。

#### 从哪里断行

自动换行的基本准则是：更倾向于在更高语法级别的地方换行，也就是说：

1. 如果在非赋值运算符处断开，那么应该在符号之前断开。(注意，这与Google其它语言的编程风格不同，比如说C++和JavaScript)
 + 这条规则也同样适用于以下“类似运算符”的符号：点分隔符(.)，两个冒号的方法引用(::)，类型界限中的&(``<T extends Foo & Bar>``)，以及catch块中的管道符号(``catch (FooException | BarException e)``)。
2. 如果在赋值语句处断开，通常的做法是在该符号后断开(比如在=后面断开)，但是其它方式也是可以接受的。
 + 这条规则也同样适用于“类似赋值操作符”，在``foreach``中的冒号。
3. 方法名或者构造方法名与开括号(()留在同一行。
4. 逗号与前面的内容在一行。

> Note: 自动换行的目的是为了让代码看上去更清楚，不一定符合最小的代码行数。

#### 自动换行时至少4个空格

当自动换行时，在第一行后的每一行至少要有4个空格的缩进。

当有多个自动换行时，缩进可能超过4个空格。一般来说，两个连续行适用相同的缩进级别当且仅当它们开始于同级语法元素。

**水平对齐**一节中指出，不鼓励使用可变数目的空格来对齐前面的行。

### 空格

#### 垂直空格

以下情况需要一个空行：

1. 类内成员或者初始化块之间：字段，构造方法，方法，内部类，静态初始化块，实例初始化块。
+ 例外：在两个连续的字段(中间没有其它的代码)之间的空行是可选的。这种空行在需要创建字段的逻辑分组的时候使用。
+ 例外：枚举常量之间的空行在**枚举类**一节中说明。
2. 在语句间，当需要组织代码的逻辑分组时。
3. 可以在类的第一个成员前或者在最后一个成员后(既不推荐使用也不反对)。
4. 满足文档中其它部分的空行需求时(比如说在第3节，源代码结构，以及3.3节，import语句)。

多个连续的空行是允许的，但永远不是必须的(或者鼓励使用的)。

#### 水平空格

除了语言和其它规则的要求，并且除了字面量，注释和Javadoc，单个ASCII字符出现空格之外，空格出现并且只出现在以下地方：

//todo fix format
1. 分隔关键字，比如说``if, for ``或者``catch``与跟在后面的开括号(()
2. 分隔关键字，比如说``else``或者``catch``与跟在后面的闭大括号(})
3. 在任何开大括号之前({)，除了以下两种例外情况：
 + ``@SomeAnnotation({a, b})``不使用括号
 + ``String[][] x = {{"foo"}};``(在{{之间没有空格，见第8条)
4. 在任何二元或者三元操作符的两侧。这条规则同样适用于下面的“类似操作符”的符号：
 + 类型界限中的&符号：``<T extends Foo & Bar>``
 + catch块中用来处理多个异常的管道符号：``catch (FooException | BarException e)``
 + foreach语句中的冒号
 + lambda表达式中的箭头：``(String str) -> str.length()``
不适用于：
 + 方法引用中的两个冒号(::)，应该这么写``Object::toString``
 + .分隔符，应该这么写``object.toString()``
5. 在``,:;``或者闭括号())之后
6. 在一条行注释语句的双斜线(//)两侧。在这里，多个空格是允许的，但不是必须的。
7. 在类型和变量声明之间：``List<String> list``
8. 在数组初始化的大括号内(可选的)
 + ``new int[] {5, 6}`` and ``new int[] { 5, 6 }``都是可以的。
这条规则不应该理解为在行的开始或结束需要或禁止使用空格，只对内部空格做要求。

#### 水平对齐：不是必须的

**术语说明：**水平对齐是指在代码上增加一些空格使得某一行的字符能和上一行的字符对齐。

在Google style中这种做法是允许的，但不是必须的。对于已经使用了这种风格的代码也不必去维持这种风格。

这是一个未使用对齐的例子，然后是使用了对齐的例子：

```java
  private int x; // this is fine
  private Color color; // this too

  private int   x;      // permitted, but future edits
  private Color color;  // may leave it unaligned
```

> Tip:
